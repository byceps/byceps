{% extends 'layout/admin/whereabouts.html' %}
{% from 'macros/icons.html' import render_icon %}
{% from 'macros/misc.html' import render_tag %}
{% set current_page = 'whereabouts_admin' %}
{% set current_tab = 'clients' %}
{% set page_title = 'Client' %}

{% macro render_authority_status_icon(status_name) %}
  {%- if status_name == 'pending' -%}
  {{ render_tag(_('pending'), icon='pending', class='color-info icon-only') }}
  {%- elif status_name == 'approved' -%}
  {{ render_tag(_('approved'), icon='enabled', class='color-success icon-only') }}
  {%- elif status_name == 'deleted' -%}
  {{ render_tag(_('deleted'), icon='delete', class='color-disabled icon-only') }}
  {%- endif -%}
{%- endmacro %}

{% macro render_interactivity(client) -%}
  {{ client.button_count }} {{ _('buttons') }}
  {%- if client.audio_output %}, {{ _('audio output') }}{% endif %}
{%- endmacro %}

{% block body %}

<div class="block row row--space-between is-vcentered">
  <div>
    <h2 class="title">{{ _('Client') }} {{ render_authority_status_icon(client.authority_status.name) }}</h2>
  </div>
  {%- if has_current_user_permission('whereabouts.administrate') %}
  <div>
    <div class="button-row is-right-aligned">
      <a class="button is-compact" href="{{ url_for('.client_update_form', client_id=client.id) }}">{{ render_icon('edit') }} <span>{{ _('Edit') }}</span></a>
      <div class="dropdown">
        <button class="dropdown-toggle button is-compact"><span>{{ render_icon('chevron-down') }}</span></button>
        <ol class="dropdown-menu dropdown-menu--right">
          <li><a class="dropdown-item color--danger" href="{{ url_for('.client_delete', client_id=client.id) }}" data-action="delete-client">{{ render_icon('delete') }} {{ _('Delete') }}</a></li>
        </ol>
      </div>
    </div>
  </div>
  {%- endif %}
</div>

<div class="block row">
  <div class="box column--grow">

    <div class="data-label">{{ _('Name') }}</div>
    <div class="data-value"><strong>{{ client.name|fallback }}</strong></div>

    <div class="data-label">{{ _('ID') }}</div>
    <div class="data-value">{{ client.id }}</div>

    <div class="data-label">{{ _('Location') }}</div>
    <div class="data-value">{{ client.location|fallback }}</div>

  </div>
  <div class="box column--grow">

    <div class="data-label">{{ _('Description') }}</div>
    <div class="data-value">{{ client.description|fallback }}</div>

    <div class="data-label">{{ _('Interactivity') }}</div>
    <div class="data-value">{{ render_interactivity(client) }}</div>

  </div>
  <div class="box">

    <div class="data-label">{{ _('Configuration') }}</div>
    <div class="data-value">{{ client.config_id|fallback }}</div>

  </div>
  <div class="box">

    <div class="data-label">{{ _('Registered at') }}</div>
    <div class="data-value"><time datetime="{{ client.registered_at.isoformat() }}" title="{{ client.registered_at|datetimeformat }}">{{ _('since') }} {{ client.registered_at|timedeltaformat }}</time></div>

    <div class="data-label">{{ _('Last activity at') }}</div>
    <div class="data-value">{{ client.latest_activity_at|datetimeformat }}</div>

    <div class="data-label">{{ _('Status') }}</div>
    <div class="data-value">{{ render_tag(_('Signed on'), class='color-success') if client.signed_on else render_tag(_('Signed off'), class='color-disabled')  }}</div>

  </div>
</div>

{%- endblock %}

{% block scripts %}
<script>
  onDomReady(() => {
    confirmed_delete_on_click_then_reload('[data-action="delete-client"]', '{{ _('Delete client?') }}');
  });
</script>
{% endblock %}
